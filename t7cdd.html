<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trắc Nghiệm Tin Học 7 - Chủ Đề D (Trộn Đề)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');

        :root {
            --primary-color: #0084ff;
            --secondary-color: #e0f2fe;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --error-color: #ef4444;
            --text-color: #334155;
            --bg-color: #f0f9ff;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: white;
            width: 95%;
            max-width: 800px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
            min-height: 500px;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        h1 { margin: 0; font-size: 1.5rem; }
        h2 { margin: 5px 0 0; font-size: 1rem; font-weight: 400; opacity: 0.9; }

        /* Screens */
        .screen {
            padding: 30px;
            flex-grow: 1;
            display: none; /* Hidden by default */
            flex-direction: column;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Login Form */
        .form-group {
            margin-bottom: 20px;
        }
       
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
        }

        /* UPDATE: Thêm select vào CSS để đồng bộ giao diện */
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #cbd5e1;
            border-radius: 10px;
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s;
            background-color: white;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.1s, background 0.3s;
            display: inline-block;
            text-align: center;
            user-select: none;
        }

        .btn:hover { background: #0066cc; }
        .btn:active { transform: scale(0.98); }

        .btn-secondary {
            background: #94a3b8;
        }
        .btn-secondary:hover { background: #64748b; }

        .btn-submit {
            background: var(--success-color);
        }
        .btn-submit:hover { background: #059669; }
       
        .btn-danger {
            background: var(--error-color);
        }
        .btn-danger:hover { background: #dc2626; }

        /* Quiz UI */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
        }

        .timer {
            font-weight: 700;
            color: var(--error-color);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .question-number {
            font-weight: 700;
            color: var(--primary-color);
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .options-grid {
            display: grid;
            gap: 15px;
        }

        .option-card {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .option-card:hover {
            border-color: var(--primary-color);
            background: var(--secondary-color);
        }

        .option-card.selected {
            border-color: var(--primary-color);
            background: var(--secondary-color);
            position: relative;
        }

        .option-card.selected::after {
            content: '✓';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-weight: bold;
        }

        .option-letter {
            font-weight: 700;
            min-width: 25px;
            color: var(--primary-color);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
            padding-top: 20px;
        }

        /* Progress Bar */
        .progress-container {
            height: 6px;
            background: #e2e8f0;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
       
        .progress-bar {
            height: 100%;
            background: var(--success-color);
            width: 0%;
            transition: width 0.3s;
        }

        /* Results */
        .score-box {
            background: var(--secondary-color);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .score-number {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary-color);
        }

        .info-summary {
            text-align: center;
            margin-bottom: 20px;
            color: #64748b;
        }

        .review-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 10px;
        }

        .review-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
       
        .review-item:last-child { border-bottom: none; }

        .review-q { font-weight: 700; margin-bottom: 8px; }
       
        .review-ans {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            margin-top: 5px;
            display: block;
        }
       
        .correct-ans { background: #dcfce7; color: #166534; border: 1px solid #86efac; }
        .wrong-ans { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }
        .user-ans-label { font-weight: 600; font-size: 0.8rem; text-transform: uppercase; margin-right: 5px; }

        /* Modal/Toast */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 16px;
            position: fixed;
            z-index: 99;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 17px;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }
       
        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.2s;
        }
       
        .modal-overlay.active {
            display: flex;
        }
       
        .modal-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
       
        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-color);
        }
       
        .modal-body {
            margin-bottom: 20px;
            color: #64748b;
        }
       
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
       
        .badge-random {
            background-color: var(--accent-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 10px;
            vertical-align: middle;
        }

    </style>
</head>
<body>

    <div class="container">
        <div class="progress-container"><div class="progress-bar" id="progress-bar"></div></div>
       
        <header>
            <h1>Trắc Nghiệm Tin Học 7 <span class="badge-random">Đề Trộn</span></h1>
            <h2>Chủ đề D: Đạo đức, pháp luật và văn hoá trong môi trường số</h2>
        </header>

        <div id="screen-login" class="screen active">
            <div style="text-align: center; margin-bottom: 20px;">
                <img src="https://cdn-icons-png.flaticon.com/512/3408/3408545.png" alt="Icon" width="80" style="margin-bottom: 10px;">
                <p>Chào mừng các em! Bài kiểm tra gồm <strong>30 câu hỏi</strong> trong <strong>10 phút</strong>.</p>
                <p style="color: var(--primary-color); font-size: 0.9rem;"><i>*Lưu ý: Câu hỏi và đáp án sẽ được trộn ngẫu nhiên.</i></p>
            </div>
           
            <div class="form-group">
                <label>Họ và tên học sinh:</label>
                <input type="text" id="input-name" placeholder="Nhập họ tên đầy đủ...">
            </div>
            
            <div style="display: flex; gap: 20px;">
                <div class="form-group" style="flex: 1;">
                    <label>Lớp:</label>
                    <select id="input-class">
                        <option value="" disabled selected>Chọn lớp</option>
                        <option value="7.1">7.1</option>
                        <option value="7.2">7.2</option>
                        <option value="7.3">7.3</option>
                        <option value="7.4">7.4</option>
                        <option value="7.5">7.5</option>
                        <option value="7.6">7.6</option>
                        <option value="7.7">7.7</option>
                        <option value="7.8">7.8</option>
                        <option value="7.9">7.9</option>
                        <option value="7.10">7.10</option>
                        <option value="7.11">7.11</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>STT (1-55):</label>
                    <input type="number" id="input-id" placeholder="STT" min="1" max="55">
                </div>
            </div>
            
            <button class="btn" onclick="startQuiz()" style="width: 100%; margin-top: 10px;">Bắt đầu làm bài</button>
        </div>

        <div id="screen-quiz" class="screen">
            <div class="quiz-header">
                <div class="question-number">Câu hỏi <span id="q-current">1</span>/30</div>
                <div class="timer">⏱ <span id="timer-display">10:00</span></div>
            </div>

            <div class="question-text" id="question-text">Loading...</div>
           
            <div class="options-grid" id="options-container">
                </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" id="btn-prev" onclick="prevQuestion()">Quay lại</button>
                <button class="btn" id="btn-next" onclick="nextQuestion()">Câu tiếp theo</button>
            </div>
        </div>

        <div id="screen-result" class="screen">
            <div class="info-summary" id="result-info"></div>
           
            <div class="score-box">
                <div>Điểm số của bạn</div>
                <div class="score-number" id="score-display">0/30</div>
                <div id="score-percent"></div>
            </div>

            <h3 style="margin-bottom: 10px;">Xem lại bài làm:</h3>
            <div class="review-list" id="review-list">
                </div>

            <button class="btn" onclick="location.reload()" style="width: 100%; margin-top: 20px;">Làm lại bài mới</button>
        </div>
    </div>

    <div id="toast">Thông báo</div>
   
    <div class="modal-overlay" id="confirm-modal">
        <div class="modal-box">
            <div class="modal-title" id="modal-title">Nộp bài?</div>
            <div class="modal-body" id="modal-body">Bạn có chắc chắn muốn nộp bài không?</div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Xem lại</button>
                <button class="btn btn-submit" onclick="submitQuiz()">Nộp bài</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        // Original data source
        const rawQuestionsDB = [
                               {
                                   "id": 1,
                                   "q": "Bạn đang ăn cơm tối cùng gia đình nhưng vẫn dán mắt vào điện thoại để chat với bạn bè. Hành động này vi phạm lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 6: Đừng để game, mạng xã hội biến mình thành nô lệ",
                                   "B. Lời khuyên 2: Giữ gìn hình ảnh bản thân trên không gian mạng",
                                   "C. Lời khuyên 1: Tôn trọng những người xung quanh",
                                   "D. Lời khuyên 5: Hãy lịch sự sớm trả lời email, tin nhắn"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 2,
                                   "q": "Khi đang giao tiếp trực tiếp với người khác, bạn nhận được một tin nhắn. Bạn xin lỗi vì đã bị tách ra để trả lời tin nhắn một cách nhanh chóng. Việc này thể hiện sự tuân thủ lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 3: Hãy tử tế với người khác trên không gian mạng",
                                   "B. Lời khuyên 10: Đừng vô tình \"ăn cắp\" trên không gian mạng",
                                   "C. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác",
                                   "D. Lời khuyên 1: Tôn trọng những người xung quanh"
                                   ],
                                   "correct": "D"
                               },
                               {
                                   "id": 3,
                                   "q": "Tại nơi công cộng như rạp chiếu phim hay phòng học, việc cần chú ý không gây phiền nhiễu cho người khác bằng thiết bị điện tử của mình thuộc về lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 1: Tôn trọng những người xung quanh",
                                   "B. Lời khuyên 9: Không lan truyền tin giả, bài viết xuyên tạc sự thật, hình ảnh đồi truỵ",
                                   "C. Lời khuyên 8: Bắt nạt, tiếp tay cho kẻ bắt nạt là vi phạm pháp luật",
                                   "D. Lời khuyên 6: Đừng để game, mạng xã hội biến mình thành nô lệ"
                                   ],
                                   "correct": "A"
                               },
                               {
                                   "id": 4,
                                   "q": "Bạn đăng tải một bài viết bày tỏ thái độ thiếu tôn trọng hoặc sử dụng ngôn ngữ khiếm nhã trên trang cá nhân của mình. Hành động này vi phạm lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 1: Tôn trọng những người xung quanh",
                                   "B. Lời khuyên 2: Giữ gìn hình ảnh bản thân trên không gian mạng",
                                   "C. Lời khuyên 3: Hãy tử tế với người khác trên không gian mạng",
                                   "D. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác"
                                   ],
                                   "correct": "B"
                               },
                               {
                                   "id": 5,
                                   "q": "Bạn luôn cân nhắc kỹ lưỡng nội dung trước khi đăng tải trên mạng vì biết rằng những gì đã đưa lên mạng sẽ rất khó thu hồi được. Bạn đang thực hiện lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 10: Đừng vô tình \"ăn cắp\" trên không gian mạng",
                                   "B. Lời khuyên 9: Không lan truyền tin giả, bài viết xuyên tạc sự thật, hình ảnh đồi truỵ",
                                   "C. Lời khuyên 2: Giữ gìn hình ảnh bản thân trên không gian mạng",
                                   "D. Lời khuyên 7: Cảnh giác với kẻ dụ dỗ và bắt nạt"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 6,
                                   "q": "Hình ảnh cá nhân được xây dựng trên mạng xã hội có thể ảnh hưởng đến cuộc sống thực và các mối quan hệ xã hội của bạn. Điều này nhấn mạnh tầm quan trọng của lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 5: Hãy lịch sự sớm trả lời email, tin nhắn",
                                   "B. Lời khuyên 2: Giữ gìn hình ảnh bản thân trên không gian mạng",
                                   "C. Lời khuyên 8: Bắt nạt, tiếp tay cho kẻ bắt nạt là vi phạm pháp luật",
                                   "D. Lời khuyên 6: Đừng để game, mạng xã hội biến mình thành nô lệ"
                                   ],
                                   "correct": "B"
                               },
                               {
                                   "id": 7,
                                   "q": "Quy tắc chung trong ứng xử là: \"Đừng làm với người khác những gì mà chính mình không muốn phải nhận\". Quy tắc này liên quan đến lời khuyên nào khi giao tiếp qua mạng?",
                                   "options": [
                                   "A. Lời khuyên 1: Tôn trọng những người xung quanh",
                                   "B. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác",
                                   "C. Lời khuyên 3: Hãy tử tế với người khác trên không gian mạng",
                                   "D. Lời khuyên 2: Giữ gìn hình ảnh bản thân trên không gian mạng"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 8,
                                   "q": "Bạn nhận thấy một người bạn mắc lỗi nào đó trên mạng. Thay vì công khai chỉ trích, bạn gửi tin nhắn riêng để góp ý. Bạn đang thực hiện lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 7: Cảnh giác với kẻ dụ dỗ và bắt nạt",
                                   "B. Lời khuyên 3: Hãy tử tế với người khác trên không gian mạng",
                                   "C. Lời khuyên 8: Bắt nạt, tiếp tay cho kẻ bắt nạt là vi phạm pháp luật",
                                   "D. Lời khuyên 1: Tôn trọng những người xung quanh"
                                   ],
                                   "correct": "B"
                               },
                               {
                                   "id": 9,
                                   "q": "Hành vi tùy tiện đưa ra các phán xét xúc phạm một người trên mạng, ngay cả khi người đó không có mặt để đáp trả, vi phạm lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 2: Giữ gìn hình ảnh bản thân trên không gian mạng",
                                   "B. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác",
                                   "C. Lời khuyên 3: Hãy tử tế với người khác trên không gian mạng",
                                   "D. Lời khuyên 10: Đừng vô tình \"ăn cắp\" trên không gian mạng"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 10,
                                   "q": "Bạn bè tin tưởng chia sẻ một số chuyện riêng tư qua cuộc trò chuyện cá nhân. Bạn không nên chuyển tiếp nội dung này khi chưa được sự đồng ý của họ, theo lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 1: Tôn trọng những người xung quanh",
                                   "B. Lời khuyên 5: Hãy lịch sự sớm trả lời email, tin nhắn",
                                   "C. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác",
                                   "D. Lời khuyên 7: Cảnh giác với kẻ dụ dỗ và bắt nạt"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 11,
                                   "q": "Việc bạn vô tư công khai số điện thoại và địa chỉ nhà của một người bạn lên mạng xã hội là vi phạm lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 2: Giữ gìn hình ảnh bản thân trên không gian mạng",
                                   "B. Lời khuyên 8: Bắt nạt, tiếp tay cho kẻ bắt nạt là vi phạm pháp luật",
                                   "C. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác",
                                   "D. Lời khuyên 9: Không lan truyền tin giả, bài viết xuyên tạc sự thật, hình ảnh đồi truỵ"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 12,
                                   "q": "Những \"bí mật\" chỉ giữa hai người rất dễ bị chuyển tiếp tới nhiều người khác nếu bạn không tôn trọng điều gì?",
                                   "options": [
                                   "A. Lời khuyên 3: Hãy tử tế với người khác trên không gian mạng",
                                   "B. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác",
                                   "C. Lời khuyên 6: Đừng để game, mạng xã hội biến mình thành nô lệ",
                                   "D. Lời khuyên 10: Đừng vô tình \"ăn cắp\" trên không gian mạng"
                                   ],
                                   "correct": "B"
                               },
                               {
                                   "id": 13,
                                   "q": "Nếu đã kết bạn qua mạng hay cho ai đó thông tin để liên lạc với mình (như địa chỉ email, số điện thoại), bạn cần làm gì khi nhận tin nhắn hoặc email?",
                                   "options": [
                                   "A. Lịch sự trả lời một cách nhanh chóng",
                                   "B. Có thể bỏ qua nếu tin nhắn không quan trọng",
                                   "C. Chỉ cần đọc mà không cần trả lời",
                                   "D. Chuyển tiếp tin nhắn cho người khác xem"
                                   ],
                                   "correct": "A"
                               },
                               {
                                   "id": 14,
                                   "q": "Nếu bạn nhận được email hoặc tin nhắn quan trọng nhưng không thể sớm trả lời, bạn nên làm gì để thể hiện phép lịch sự?",
                                   "options": [
                                   "A. Bỏ qua và chờ đến khi có thời gian trả lời chi tiết",
                                   "B. Gửi email từ chối nhã nhặn ngay lập tức",
                                   "C. Nên báo đã nhận và hẹn trả lời sau",
                                   "D. Đăng câu hỏi này lên mạng xã hội để xin ý kiến"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 15,
                                   "q": "Nếu không muốn trả lời một email/tin nhắn, để tránh bị coi là bỏ qua quá lâu, lời khuyên là bạn nên làm gì?",
                                   "options": [
                                   "A. Gửi email từ chối nhã nhặn",
                                   "B. Đánh dấu thư đó là spam",
                                   "C. Không trả lời và chặn người gửi",
                                   "D. Hỏi ý kiến một người bạn thân"
                                   ],
                                   "correct": "A"
                               },
                               {
                                   "id": 16,
                                   "q": "Hành vi sống ảo, lạm dụng quá nhiều các giao tiếp trực tuyến và mạng xã hội có thể dẫn đến hậu quả gì?",
                                   "options": [
                                   "A. Cải thiện kỹ năng giao tiếp xã hội",
                                   "B. Giúp tìm kiếm thông tin hiệu quả hơn",
                                   "C. Ảnh hưởng đến học tập và làm việc",
                                   "D. Tôn trọng quyền riêng tư của người khác"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 17,
                                   "q": "Việc chơi game liên tục nhiều ngày, dẫn đến kiệt sức khỏe và thậm chí tử vong, vi phạm lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 2: Giữ gìn hình ảnh bản thân trên không gian mạng",
                                   "B. Lời khuyên 6: Đừng để game, mạng xã hội biến mình thành nô lệ",
                                   "C. Lời khuyên 7: Cảnh giác với kẻ dụ dỗ và bắt nạt",
                                   "D. Lời khuyên 1: Tôn trọng những người xung quanh"
                                   ],
                                   "correct": "B"
                               },
                               {
                                   "id": 18,
                                   "q": "Để phòng tránh tác hại của Internet và đảm bảo sử dụng có kiểm soát, bạn nên tuân theo quy định hạn chế của bố mẹ hoặc tự đặt ra khung giờ sử dụng mỗi ngày. Việc này thuộc lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 5: Hãy lịch sự sớm trả lời email, tin nhắn",
                                   "B. Lời khuyên 10: Đừng vô tình \"ăn cắp\" trên không gian mạng",
                                   "C. Lời khuyên 6: Đừng để game, mạng xã hội biến mình thành nô lệ",
                                   "D. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 19,
                                   "q": "Kẻ dụ dỗ trên mạng thường lợi dụng sự nhẹ dạ, cả tin của lứa tuổi học sinh để thực hiện hành vi xấu. Khi nhận diện kẻ xấu, bạn cần thực hiện lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 1: Tôn trọng những người xung quanh",
                                   "B. Lời khuyên 7: Cảnh giác với kẻ dụ dỗ và bắt nạt",
                                   "C. Lời khuyên 3: Hãy tử tế với người khác trên không gian mạng",
                                   "D. Lời khuyên 10: Đừng vô tình \"ăn cắp\" trên không gian mạng"
                                   ],
                                   "correct": "B"
                               },
                               {
                                   "id": 20,
                                   "q": "Một người quen trên mạng dụ dỗ bạn làm những việc \"thân mật\" hoặc hẹn gặp riêng để tặng quà mà không có sự kiểm soát của người lớn. Bạn nên làm gì để tự bảo vệ mình?",
                                   "options": [
                                   "A. Đồng ý hẹn gặp nếu người đó có vẻ tử tế",
                                   "B. Từ chối và báo với ba mẹ",
                                   "C. Chụp ảnh người đó để đe dọa lại",
                                   "D. Chia sẻ nội dung cuộc trò chuyện với bạn bè"
                                   ],
                                   "correct": "B"
                               },
                               {
                                   "id": 21,
                                   "q": "Nếu bạn bị đe dọa hoặc bị bắt nạt trên không gian mạng, lời khuyên là bạn cần làm gì?",
                                   "options": [
                                   "A. Tự mình giải quyết bằng cách trả đũa",
                                   "B. Nhờ người lớn giúp đỡ, tư vấn",
                                   "C. Im lặng để mọi việc qua đi",
                                   "D. Chặn tài khoản người đó và xóa mọi bằng chứng"
                                   ],
                                   "correct": "B"
                               },
                               {
                                   "id": 22,
                                   "q": "Nếu bạn lan truyền những nội dung có tính bịa đặt, thất thiệt hay hình ảnh kín đáo riêng tư của nạn nhân, bạn đã vi phạm lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác",
                                   "B. Lời khuyên 9: Không lan truyền tin giả, bài viết xuyên tạc sự thật, hình ảnh đồi truỵ",
                                   "C. Lời khuyên 8: Bắt nạt, tiếp tay cho kẻ bắt nạt là vi phạm pháp luật",
                                   "D. Lời khuyên 7: Cảnh giác với kẻ dụ dỗ và bắt nạt"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 23,
                                   "q": "Hành vi đe dọa, xúc phạm, làm nhục, hoặc quấy rối nạn nhân bằng cách gửi tin nhắn trên mạng xã hội được nêu trong lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 3: Hãy tử tế với người khác trên không gian mạng",
                                   "B. Lời khuyên 8: Bắt nạt, tiếp tay cho kẻ bắt nạt là vi phạm pháp luật",
                                   "C. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác",
                                   "D. Lời khuyên 10: Đừng vô tình \"ăn cắp\" trên không gian mạng"
                                   ],
                                   "correct": "B"
                               },
                               {
                                   "id": 24,
                                   "q": "Một nhóm học sinh lập nhóm chế giễu và công kích một bạn học khác. Hành vi này vi phạm lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 2: Giữ gìn hình ảnh bản thân trên không gian mạng",
                                   "B. Lời khuyên 6: Đừng để game, mạng xã hội biến mình thành nô lệ",
                                   "C. Lời khuyên 8: Bắt nạt, tiếp tay cho kẻ bắt nạt là vi phạm pháp luật",
                                   "D. Lời khuyên 7: Cảnh giác với kẻ dụ dỗ và bắt nạt"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 25,
                                   "q": "Để tránh gây ra hậu quả nghiêm trọng trên mạng, khi đọc tin, bạn cần phải chọn lọc thông tin từ những nguồn đáng tin cậy. Điều này liên quan đến lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 7: Cảnh giác với kẻ dụ dỗ và bắt nạt",
                                   "B. Lời khuyên 6: Đừng để game, mạng xã hội biến mình thành nô lệ",
                                   "C. Lời khuyên 9: Không lan truyền tin giả, bài viết xuyên tạc sự thật, hình ảnh đồi truỵ",
                                   "D. Lời khuyên 5: Hãy lịch sự sớm trả lời email, tin nhắn"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 26,
                                   "q": "Việc tung tin giật gân, thông tin không đáng tin cậy để gây chú ý hoặc \"câu like\" trên mạng xã hội vi phạm lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 3: Hãy tử tế với người khác trên không gian mạng",
                                   "B. Lời khuyên 9: Không lan truyền tin giả, bài viết xuyên tạc sự thật, hình ảnh đồi truỵ",
                                   "C. Lời khuyên 2: Giữ gìn hình ảnh bản thân trên không gian mạng",
                                   "D. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác"
                                   ],
                                   "correct": "B"
                               },
                               {
                                   "id": 27,
                                   "q": "Việc đăng tải hoặc lan truyền các video mang nội dung xấu có tính bạo lực vi phạm lời khuyên nào, đồng thời là hành vi bị cấm theo pháp luật?",
                                   "options": [
                                   "A. Lời khuyên 8: Bắt nạt, tiếp tay cho kẻ bắt nạt là vi phạm pháp luật",
                                   "B. Lời khuyên 10: Đừng vô tình \"ăn cắp\" trên không gian mạng",
                                   "C. Lời khuyên 9: Không lan truyền tin giả, bài viết xuyên tạc sự thật, hình ảnh đồi truỵ",
                                   "D. Lời khuyên 7: Cảnh giác với kẻ dụ dỗ và bắt nạt"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 28,
                                   "q": "Bạn lấy những hình ảnh đẹp, bài văn hay của người khác trên mạng và sử dụng nguyên gốc mà không ghi rõ nguồn, coi như của mình. Hành vi này được gọi là gì, theo lời khuyên trong sách?",
                                   "options": [
                                   "A. Bắt nạt qua mạng",
                                   "B. Đạo văn",
                                   "C. Sử dụng thông tin sai mục đích",
                                   "D. Vi phạm quyền riêng tư"
                                   ],
                                   "correct": "B"
                               },
                               {
                                   "id": 29,
                                   "q": "Hành vi sử dụng mật khẩu của người khác mà không được phép. Hành vi này vi phạm lời khuyên nào?",
                                   "options": [
                                   "A. Lời khuyên 6: Đừng để game, mạng xã hội biến mình thành nô lệ",
                                   "B. Lời khuyên 4: Tôn trọng quyền riêng tư của người khác",
                                   "C. Lời khuyên 10: Đừng vô tình \"ăn cắp\" trên không gian mạng",
                                   "D. Lời khuyên 9: Không lan truyền tin giả, bài viết xuyên tạc sự thật, hình ảnh đồi truỵ"
                                   ],
                                   "correct": "C"
                               },
                               {
                                   "id": 30,
                                   "q": "Nếu bạn muốn dùng một tấm ảnh đẹp, một đoạn văn hay trên Internet, bạn cần làm gì để tránh vi phạm bản quyền?",
                                   "options": [
                                   "A. Chia sẻ cho nhiều người cùng xem",
                                   "B. Ghi rõ nguồn hoặc xin phép nếu cần",
                                   "C. Thay đổi một chút nội dung rồi đăng lại",
                                   "D. Chỉ nên sử dụng cho mục đích cá nhân"
                                   ],
                                   "correct": "B"
                               }
                               ];

        // --- STATE ---
        let sessionQuestions = [];
        let currentQuestion = 0;
        let userAnswers = new Array(30).fill(null);
        let userInfo = { name: "", class: "", id: "" };
        let timerInterval;
        let timeLeft = 600;

        // --- DOM ELEMENTS ---
        const screens = {
            login: document.getElementById('screen-login'),
            quiz: document.getElementById('screen-quiz'),
            result: document.getElementById('screen-result')
        };
        const els = {
            name: document.getElementById('input-name'),
            class: document.getElementById('input-class'),
            id: document.getElementById('input-id'),
            timer: document.getElementById('timer-display'),
            qCurrent: document.getElementById('q-current'),
            qText: document.getElementById('question-text'),
            optionsCont: document.getElementById('options-container'),
            progressBar: document.getElementById('progress-bar'),
            btnPrev: document.getElementById('btn-prev'),
            btnNext: document.getElementById('btn-next'),
            toast: document.getElementById('toast'),
            scoreDisplay: document.getElementById('score-display'),
            scorePercent: document.getElementById('score-percent'),
            resultInfo: document.getElementById('result-info'),
            reviewList: document.getElementById('review-list'),
            modal: document.getElementById('confirm-modal'),
            modalTitle: document.getElementById('modal-title'),
            modalBody: document.getElementById('modal-body')
        };

        // --- HELPER FUNCTIONS ---
       
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function showToast(message) {
            els.toast.textContent = message;
            els.toast.className = "show";
            setTimeout(function(){ els.toast.className = els.toast.className.replace("show", ""); }, 3000);
        }

        function switchScreen(screenName) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            screens[screenName].classList.add('active');
        }

        // --- MODAL FUNCTIONS ---
        function closeModal() {
            els.modal.classList.remove('active');
        }

        function checkSubmit() {
            // Count unanswered
            let unansweredCount = 0;
            userAnswers.forEach(ans => {
                if (ans === null) unansweredCount++;
            });

            if (unansweredCount > 0) {
                els.modalTitle.textContent = "Chưa hoàn thành!";
                els.modalBody.innerHTML = `Bạn còn <strong style="color:red">${unansweredCount}</strong> câu chưa trả lời.<br>Bạn có muốn nộp bài luôn không?`;
            } else {
                els.modalTitle.textContent = "Xác nhận nộp bài";
                els.modalBody.textContent = "Bạn đã làm xong tất cả câu hỏi. Bạn có chắc chắn muốn nộp không?";
            }
           
            els.modal.classList.add('active');
        }

        // --- CORE FUNCTIONS ---

        function prepareQuizData() {
            let questions = JSON.parse(JSON.stringify(rawQuestionsDB));
            shuffleArray(questions);
            questions.forEach(q => {
                const letterMap = {'A': 0, 'B': 1, 'C': 2, 'D': 3};
                const oldCorrectIndex = letterMap[q.correct];
                const originalContentArray = q.options.map(opt => opt.substring(3).trim());
                const correctContent = originalContentArray[oldCorrectIndex];
                shuffleArray(originalContentArray);
                q.newCorrectIndex = originalContentArray.indexOf(correctContent);
                q.cleanOptions = originalContentArray;
            });
            return questions;
        }

        // UPDATE: Hàm startQuiz có kiểm tra dữ liệu đầu vào
        function startQuiz() {
            const name = els.name.value.trim();
            const cls = els.class.value; // Giá trị từ dropdown
            const id = els.id.value.trim();
            const idNum = parseInt(id);

            // Kiểm tra xem đã điền đủ thông tin chưa
            if (!name || !cls || !id) {
                showToast("Vui lòng nhập đầy đủ: Họ tên, Lớp và STT!");
                return;
            }

            // Kiểm tra STT có hợp lệ không (từ 1 đến 55)
            if (isNaN(idNum) || idNum < 1 || idNum > 55) {
                showToast("Số thứ tự phải nằm trong khoảng từ 1 đến 55!");
                return;
            }

            userInfo = { name, class: cls, id };
            sessionQuestions = prepareQuizData();
            switchScreen('quiz');
            renderQuestion();
            startTimer();
        }

        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz(true); // Forced submit time out
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const s = (timeLeft % 60).toString().padStart(2, '0');
            els.timer.textContent = `${m}:${s}`;
            if (timeLeft < 60) els.timer.style.color = "red";
        }

        function renderQuestion() {
            const q = sessionQuestions[currentQuestion];
            els.qCurrent.textContent = currentQuestion + 1;
            els.qText.textContent = q.q;

            const percent = ((currentQuestion + 1) / sessionQuestions.length) * 100;
            els.progressBar.style.width = `${percent}%`;

            els.optionsCont.innerHTML = '';
           
            const labels = ['A', 'B', 'C', 'D'];
           
            q.cleanOptions.forEach((optText, index) => {
                const div = document.createElement('div');
                div.className = `option-card ${userAnswers[currentQuestion] === index ? 'selected' : ''}`;
                div.onclick = () => selectOption(index);
               
                const letterSpan = document.createElement('span');
                letterSpan.className = 'option-letter';
                letterSpan.textContent = labels[index] + ".";
               
                const textSpan = document.createElement('span');
                textSpan.textContent = optText;

                div.appendChild(letterSpan);
                div.appendChild(textSpan);
                els.optionsCont.appendChild(div);
            });

            els.btnPrev.disabled = currentQuestion === 0;
            els.btnPrev.style.opacity = currentQuestion === 0 ? "0.5" : "1";
           
            if (currentQuestion === sessionQuestions.length - 1) {
                els.btnNext.textContent = "Nộp bài";
                els.btnNext.classList.add("btn-submit");
            } else {
                els.btnNext.textContent = "Câu tiếp theo";
                els.btnNext.classList.remove("btn-submit");
            }
        }

        function selectOption(index) {
            userAnswers[currentQuestion] = index;
            const options = els.optionsCont.children;
            for (let i = 0; i < options.length; i++) {
                options[i].classList.remove('selected');
            }
            options[index].classList.add('selected');
        }

        function nextQuestion() {
            if (currentQuestion < sessionQuestions.length - 1) {
                currentQuestion++;
                renderQuestion();
            } else {
                checkSubmit();
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
            }
        }

        function submitQuiz(forced = false) {
            clearInterval(timerInterval);
            closeModal();
           
            if (forced) showToast("Hết giờ! Đã tự động nộp bài.");
           
            let score = 0;
            const reviewHTML = [];
            const labels = ['A', 'B', 'C', 'D'];

            sessionQuestions.forEach((q, idx) => {
                const userChoiceIndex = userAnswers[idx];
                const correctIndex = q.newCorrectIndex;
               
                let isCorrect = false;
                if (userChoiceIndex === correctIndex) {
                    score++;
                    isCorrect = true;
                }

                let userText = userChoiceIndex !== null ? `${labels[userChoiceIndex]}. ${q.cleanOptions[userChoiceIndex]}` : "<span style='color:red'>Chưa trả lời</span>";
                let correctText = `${labels[correctIndex]}. ${q.cleanOptions[correctIndex]}`;

                reviewHTML.push(`
                    <div class="review-item">
                        <div class="review-q">Câu ${idx + 1}: ${q.q}</div>
                        <div class="review-ans ${isCorrect ? 'correct-ans' : 'wrong-ans'}">
                            <span class="user-ans-label">Bạn chọn:</span> ${userText}
                        </div>
                        ${!isCorrect ? `
                        <div class="review-ans correct-ans">
                            <span class="user-ans-label">Đáp án đúng:</span> ${correctText}
                        </div>` : ''}
                    </div>
                `);
            });

            switchScreen('result');
            // Show new user info format
            els.resultInfo.innerHTML = `Học sinh: <b>${userInfo.name}</b> - Lớp: <b>${userInfo.class}</b> - STT: <b>${userInfo.id}</b>`;
            els.scoreDisplay.textContent = `${score}/30`;
            const percentage = Math.round((score / 30) * 100);
           
            let color = percentage >= 50 ? "green" : "red";
            els.scorePercent.innerHTML = `<span style="color:${color}">(${percentage}%)</span> - ${score >= 15 ? "Đạt" : "Cần cố gắng hơn"}`;
           
            els.reviewList.innerHTML = reviewHTML.join('');
        }
    </script>
</body>
</html>