
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√în t·∫≠p cu·ªëi k√¨ 1 Tin 7 - H√† Huy T·∫≠p</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');

        :root {
            --primary-color: #0084ff;
            --secondary-color: #e0f2fe;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --error-color: #ef4444;
            --text-color: #334155;
            --bg-color: #f0f9ff;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: white;
            width: 95%;
            max-width: 800px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
            min-height: 500px;
            display: flex;
            flex-direction: column;
        }

        header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        h1 { margin: 0; font-size: 1.5rem; }
        h2 { margin: 5px 0 0; font-size: 1rem; font-weight: 400; opacity: 0.9; }

        .screen {
            padding: 30px;
            flex-grow: 1;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-secondary {
            background: #94a3b8;
        }

        .option-card {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.2s;
        }

        .option-card.selected {
            background: var(--secondary-color);
            border-color: var(--primary-color);
        }

        .review-item {
            border: 2px solid #e5e7eb;
            padding: 12px;
            border-radius: 10px;
            background: #f9fafb;
        }

        .answer-wrong {
            color: var(--error-color);
            font-weight: bold;
        }

        .answer-correct {
            color: var(--success-color);
            font-weight: bold;
        }
    </style>
</head>

<body>
<div class="container">

<header>
    <h1>Tr·∫Øc Nghi·ªám Tin H·ªçc 7</h1>
    <h2>Ch·ªß ƒë·ªÅ A, C, D</h2>
</header>


<!-- LOGIN SCREEN -->
<div id="screen-login" class="screen active">

    <label>L·ªõp:</label>
    <select id="input-class" onchange="onClassChange()">
        <option value="">-- Ch·ªçn l·ªõp --</option>
        <option>7.1</option><option>7.2</option><option>7.3</option>
        <option>7.4</option><option>7.5</option><option>7.6</option>
        <option>7.7</option><option>7.8</option><option>7.9</option>
        <option>7.10</option><option>7.11</option>
    </select>

    <label>S·ªë th·ª© t·ª±:</label>
    <select id="input-id" onchange="onIdChange()" disabled>
        <option value="">-- Ch·ªçn STT --</option>
    </select>

    <label>H·ªç v√† t√™n:</label>
    <input type="text" id="input-name" readonly placeholder="T·ª± ƒë·ªông hi·ªÉn th·ªã">

    <button class="btn" id="btn-start" onclick="startQuiz()" disabled style="margin-top:20px;">
        L√†m b√†i
    </button>
</div>


<!-- QUIZ SCREEN -->
<div id="screen-quiz" class="screen">

    <div class="question-number">
        C√¢u h·ªèi <span id="q-current">1</span>/30
    </div>

    <div class="timer">‚è± <span id="timer-display">600s</span></div>

    <div id="question-text" style="margin:20px 0; font-weight:700;"></div>

    <div id="options-container" class="options-grid"></div>

    <div style="margin-top:auto; display:flex; justify-content:space-between;">
        <button class="btn btn-secondary" id="btn-prev" onclick="prevQuestion()">Quay l·∫°i</button>
        <button class="btn" id="btn-next" onclick="nextQuestion()">C√¢u ti·∫øp</button>
    </div>
</div>

<!-- RESULT SCREEN -->
<div id="screen-result" class="screen">
    <h2>K·∫øt qu·∫£</h2>

    <div>
        <div style="font-size:20px;">ƒêi·ªÉm s·ªë:</div>
        <div id="score-display" style="font-size:32px; font-weight:700;">0/30</div>
        <div id="score-percent"></div>
    </div>

    <button class="btn" onclick="location.reload()" style="margin-top:20px;">L√†m b√†i m·ªõi</button>

    <button class="btn" id="btn-review" style="margin-top:15px;" onclick="showReview()">Xem l·∫°i c√¢u sai</button>

    <div id="review-panel" style="margin-top:20px; display:none;">
        <h3>C√°c c√¢u b·∫°n tr·∫£ l·ªùi sai</h3>
        <div id="review-content" style="display:flex; flex-direction:column; gap:12px;"></div>
    </div>
</div>

</div>

<script>

/* ============================
   C∆† S·ªû D·ªÆ LI·ªÜU C√ÇU H·ªéI (30 c√¢u random m·ªói l·∫ßn)


const rawQuestionsDB = [
    { q:"Thi·∫øt b·ªã n√†o l√† thi·∫øt b·ªã v√†o?", options:["Loa","Chu·ªôt, b√†n ph√≠m","M√†n h√¨nh","M√°y chi·∫øu"], correct:1 },
    { q:"Thi·∫øt b·ªã n√†o l√† thi·∫øt b·ªã ra?", options:["B√†n ph√≠m","Chu·ªôt","Loa","Webcam"], correct:2 },
    ·ªÉ tr√°nh b·ªã l·ª´a ƒë·∫£o qua m·∫°ng, ta n√™n:", options:["Nh·∫•p m·ªçi ƒë∆∞·ªùng link","Tin ph·∫ßn th∆∞·ªüng ·∫£o","Kh√¥ng cung c·∫•p m√£ OTP","G·ª≠i m·∫≠t kh·∫©u n·∫øu ƒë∆∞·ª£c y√™u c·∫ßu"], correct:2 }
];

/* ============================
   CODE CH·∫†Y B√ÄI TEST
============================ */
let rawQuestionsDB = [];
async function loadQuestionsFromJSON() {
    try {
        const response = await fetch("ontap7hk1.json");
        rawQuestionsDB = await response.json();
    } catch (err) {
        alert("‚ùå Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu c√¢u h·ªèi!");
        console.error(err);
    }
}

//--------------- x·ª≠ l√Ω l·ªõp ‚Äì STT ‚Äì t√™n
let studentsData = {};

// load students.json
fetch("students.json")
    .then(res => res.json())
    .then(data => studentsData = data)
    .catch(err => alert("‚ùå Kh√¥ng t·∫£i ƒë∆∞·ª£c danh s√°ch h·ªçc sinh"));

function onClassChange() {
    const classSelect = document.getElementById("input-class");
    const idSelect = document.getElementById("input-id");
    const nameInput = document.getElementById("input-name");
    const btn = document.getElementById("btn-start");

    idSelect.innerHTML = '<option value="">-- Ch·ªçn STT --</option>';
    nameInput.value = "";
    btn.disabled = true;

    const lop = classSelect.value;
    if (!lop) {
        idSelect.disabled = true;
        return;
    }

    studentsData[lop].forEach(hs => {
        const opt = document.createElement("option");
        opt.value = hs.stt;
        opt.textContent = hs.stt;
        idSelect.appendChild(opt);
    });

    idSelect.disabled = false;
}

function onIdChange() {
    const lop = document.getElementById("input-class").value;
    const stt = document.getElementById("input-id").value;
    const nameInput = document.getElementById("input-name");
    const btn = document.getElementById("btn-start");

    if (!lop || !stt) {
        nameInput.value = "";
        btn.disabled = true;
        return;
    }

    const hs = studentsData[lop].find(s => s.stt == stt);
    if (hs) {
        nameInput.value = hs.ten;
        btn.disabled = false;
    }
}

//---------------------------------------------------------------

function shuffleArray(arr){
    for(let i=arr.length-1;i>0;i--){
        let j=Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
    }
}

function prepareQuizData() {
    let arr = JSON.parse(JSON.stringify(rawQuestionsDB));

    arr.forEach(q=>{
        q.cleanOptions=[...q.options];
        q.newCorrectIndex=q.correct;
    });

    shuffleArray(arr);
    return arr.slice(0,30);
}

let sessionQuestions=[];
let studentInfo = {};
let currentQuestion=0;
let userAnswers=new Array(30).fill(null);
let timerInterval;
let timeLeft=600;

const screens={
    login:document.getElementById("screen-login"),
    quiz:document.getElementById("screen-quiz"),
    result:document.getElementById("screen-result")
};

async function startQuiz(){
    const name = document.getElementById("input-name").value;
    const lop = document.getElementById("input-class").value;
    const stt = document.getElementById("input-id").value;

    
    if (!name || !lop || !stt) {
        alert("‚ö†Ô∏è Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß l·ªõp v√† s·ªë th·ª© t·ª±");
        return;
    }
    
    studentInfo = {
        lop: document.getElementById("input-class").value,
        stt: document.getElementById("input-id").value,
        ten: document.getElementById("input-name").value
    };

    await loadQuestionsFromJSON();   // ‚¨ÖÔ∏è LOAD JSON TR∆Ø·ªöC

    if(rawQuestionsDB.length === 0){
        alert("Kh√¥ng c√≥ c√¢u h·ªèi!");
        return;
    }

    screens.login.style.display="none";
    screens.quiz.style.display="flex";

    sessionQuestions = prepareQuizData();
    renderQuestion();
    startTimer();
}


function startTimer(){
    timerInterval=setInterval(()=>{
        timeLeft--;
        document.getElementById("timer-display").textContent=timeLeft+"s";
        if(timeLeft<=0) submitQuiz();
    },1000);
}

function renderQuestion(){
    let q=sessionQuestions[currentQuestion];

    document.getElementById("q-current").textContent=currentQuestion+1;
    document.getElementById("question-text").textContent=q.q;

    let cont=document.getElementById("options-container");
    cont.innerHTML="";

    q.cleanOptions.forEach((opt,idx)=>{
        let div=document.createElement("div");
        div.className="option-card";
        div.textContent=String.fromCharCode(65+idx)+". "+opt;

        if(userAnswers[currentQuestion]===idx)
            div.classList.add("selected");

        div.onclick=()=>selectOption(idx);
        cont.appendChild(div);
    });

    document.getElementById("btn-prev").style.display=currentQuestion>0?"block":"none";
    document.getElementById("btn-next").textContent=currentQuestion===29?"N·ªôp b√†i":"C√¢u ti·∫øp";
}

function selectOption(idx){
    userAnswers[currentQuestion]=idx;
    renderQuestion();
}

function nextQuestion(){
    if(currentQuestion===29) return submitQuiz();
    currentQuestion++;
    renderQuestion();
}

function prevQuestion(){
    currentQuestion--;
    renderQuestion();
}

function submitQuiz(){
    clearInterval(timerInterval);

    let correct = 0;
    sessionQuestions.forEach((q,i)=>{
        if(userAnswers[i] === q.newCorrectIndex) correct++;
    });

    const percent = Math.round(correct / 30 * 100);
    const timeUsed = 600 - timeLeft;

    // G·ª¨I GOOGLE SHEET
    fetch("https://script.google.com/macros/s/AKfycbyfkr70qrqHZDGE91yeKAIyaLnkfSKUAV1yiesooCP7S74Zmq7Gm9UKY66MMwwNesDNcg/exec", {
        method: "POST",
        body: new URLSearchParams({
            lop: studentInfo.lop,
            stt: studentInfo.stt,
            ten: studentInfo.ten,
            diem: `${correct}/30`,            
            thoigian: timeUsed
        })
    })
    .then(() => console.log("‚úÖ ƒê√£ g·ª≠i k·∫øt qu·∫£"))
    .catch(err => console.error("‚ùå L·ªói g·ª≠i Sheet:", err));


    // HI·ªÇN TH·ªä K·∫æT QU·∫¢
    screens.quiz.style.display="none";
    screens.result.style.display="flex";

    document.getElementById("score-display").textContent = `${correct}/30`;
    document.getElementById("score-percent").textContent = percent + "%";
}


/* ============================
   T√çNH NƒÇNG XEM L·∫†I C√ÇU SAI
============================ */

function showReview(){
    let box=document.getElementById("review-panel");
    let area=document.getElementById("review-content");

    box.style.display="block";
    area.innerHTML="";

    sessionQuestions.forEach((q,i)=>{
        let user=userAnswers[i];
        let correct=q.newCorrectIndex;

        if(user!==correct){
            let div=document.createElement("div");
            div.className="review-item";

            div.innerHTML=`
                <div><strong>C√¢u ${i+1}:</strong> ${q.q}</div>
                <div>‚Ä¢ B·∫°n ch·ªçn: <span class="answer-wrong">${q.cleanOptions[user] ?? "Kh√¥ng ch·ªçn"}</span></div>
                <div>‚Ä¢ ƒê√°p √°n ƒë√∫ng: <span class="answer-correct">${q.cleanOptions[correct]}</span></div>
            `;

            area.appendChild(div);
        }
    });

    if(area.innerHTML.trim()===""){
        area.innerHTML=`<div style="color:green; font-weight:700;">Tuy·ªát v·ªùi! B·∫°n kh√¥ng sai c√¢u n√†o üéâ</div>`;
    }

    setTimeout(()=>box.scrollIntoView({behavior:"smooth"}),200);
}

</script>

</body>
</html>
