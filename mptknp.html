<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mô phỏng Thuật toán Tìm kiếm Nhị phân</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }
        .glass-morphism {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 24px;
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.05);
        }
        .array-item {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .active-range {
            background-color: #eff6ff !important;
            border: 2px solid #3b82f6 !important;
            color: #1e40af;
        }
        .mid-item {
            background-color: #fbbf24 !important;
            color: #1e1b4b !important;
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
            border-color: #d97706 !important;
            z-index: 20;
        }
        .found-item {
            background-color: #10b981 !important;
            color: white !important;
            transform: scale(1.15);
            border-color: #059669 !important;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
            z-index: 30;
        }
        .inactive-item {
            opacity: 0.3;
            filter: grayscale(0.8);
            background-color: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 5px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        @keyframes pulse-soft {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .pulse {
            animation: pulse-soft 2s infinite;
        }
    </style>
</head>
<body class="p-4 md:p-8 lg:p-12 flex justify-center items-start">
    <div id="app" class="w-full max-w-7xl">
        <!-- Màn hình thiết lập -->
        <div id="setup-screen" class="glass-morphism p-8 md:p-16 text-center max-w-3xl mx-auto mt-10">
            <h1 class="text-4xl font-extrabold text-slate-800 mb-2 tracking-tight">Binary Search Visualizer</h1>
            <p class="text-slate-500 mb-10 text-lg">Học thuật toán tìm kiếm nhị phân qua minh họa trực quan</p>
            
            <div class="space-y-8 text-left">
                <!-- Chọn dãy số -->
                <div>
                    <label class="block text-xs font-bold text-slate-400 mb-4 uppercase tracking-widest">1. Chọn bộ dữ liệu:</label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="selectArray(1)" id="btn-arr-1" class="array-select-btn p-5 rounded-2xl border-2 border-slate-100 hover:border-indigo-300 bg-white text-slate-700 transition-all text-left flex flex-col group relative">
                            <span class="text-xs text-indigo-500 font-bold mb-1">Dãy 1 (Chẵn)</span>
                            <span class="font-mono text-sm">[6, 12, 18, 42, 44, 55, 67, 94]</span>
                        </button>
                        <button onclick="selectArray(2)" id="btn-arr-2" class="array-select-btn p-5 rounded-2xl border-2 border-slate-100 hover:border-indigo-300 bg-white text-slate-700 transition-all text-left flex flex-col group">
                            <span class="text-xs text-indigo-500 font-bold mb-1">Dãy 2 (Lẻ)</span>
                            <span class="font-mono text-sm">[5, 11, 18, 39, 41, 52, 63, 70, 85, 88, 91]</span>
                        </button>
                    </div>
                </div>

                <!-- Nhập giá trị cần tìm -->
                <div class="max-w-md">
                    <label class="block text-xs font-bold text-slate-400 mb-4 uppercase tracking-widest">2. Nhập số cần tìm:</label>
                    <input type="number" id="target-input" value="44" class="w-full px-6 py-4 bg-white border-2 border-slate-100 rounded-2xl focus:border-indigo-500 outline-none transition-all text-2xl font-bold text-indigo-600 shadow-inner" placeholder="Ví dụ: 44">
                </div>

                <div class="pt-6">
                    <button onclick="startSimulation()" class="w-full bg-slate-900 hover:bg-indigo-700 text-white font-bold py-5 rounded-2xl transition-all shadow-xl hover:-translate-y-1 text-lg uppercase tracking-wider">
                        Bắt đầu mô phỏng ngay
                    </button>
                </div>
            </div>
        </div>

        <!-- Màn hình mô phỏng (Laptop Layout) -->
        <div id="sim-screen" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
            
            <!-- Header Bar (Full width) -->
            <div class="lg:col-span-12 glass-morphism p-5 flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-4">
                    <div class="p-3 bg-indigo-100 text-indigo-600 rounded-xl">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-slate-800">Đang tìm: <span id="display-target" class="text-indigo-600">0</span></h2>
                        <p id="status-text" class="text-slate-500 text-sm font-medium italic">Khởi tạo hệ thống...</p>
                    </div>
                </div>
                <button onclick="location.reload()" class="w-full md:w-auto px-6 py-3 bg-slate-100 text-slate-600 rounded-xl font-bold hover:bg-slate-200 transition-all flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    Thoát
                </button>
            </div>

            <!-- Cột Trái: Trực quan hóa & Điều khiển -->
            <div class="lg:col-span-8 space-y-6">
                <!-- Vùng hiển thị dãy số -->
                <div class="glass-morphism p-8 md:p-12 min-h-[400px] flex flex-col justify-between">
                    <div id="array-container" class="flex flex-wrap justify-center gap-3 md:gap-4 mb-20 py-10">
                        <!-- Items injected here -->
                    </div>

                    <!-- Chỉ dẫn Pointer -->
                    <div class="grid grid-cols-3 gap-2 max-w-lg mx-auto mb-10">
                        <div class="flex items-center gap-2 text-[10px] md:text-xs font-bold text-slate-400 uppercase tracking-tighter">
                            <div class="w-3 h-3 bg-blue-100 border border-blue-400 rounded-sm"></div> Vùng đang xét
                        </div>
                        <div class="flex items-center gap-2 text-[10px] md:text-xs font-bold text-slate-400 uppercase tracking-tighter">
                            <div class="w-3 h-3 bg-amber-400 rounded-sm"></div> Vị trí giữa (M)
                        </div>
                        <div class="flex items-center gap-2 text-[10px] md:text-xs font-bold text-slate-400 uppercase tracking-tighter">
                            <div class="w-3 h-3 bg-emerald-500 rounded-sm"></div> Kết quả tìm thấy
                        </div>
                    </div>

                    <!-- Hộp giải thích bước -->
                    <div class="flex flex-col md:flex-row items-stretch gap-4">
                        <div id="step-desc" class="flex-grow p-6 bg-slate-50 rounded-2xl border border-slate-100 text-slate-700 font-semibold text-lg flex items-center justify-center text-center leading-relaxed">
                            Sẵn sàng bắt đầu...
                        </div>
                        <button id="next-btn" onclick="stepForward()" class="md:w-64 bg-indigo-600 hover:bg-indigo-700 text-white font-extrabold py-5 px-8 rounded-2xl transition-all shadow-lg active:scale-95 text-lg flex items-center justify-center gap-2">
                            BƯỚC TIẾP <span class="hidden md:inline">→</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Cột Phải: Nhật ký (Chỉ hiện tốt trên Laptop) -->
            <div class="lg:col-span-4 h-full">
                <div class="glass-morphism p-6 h-full flex flex-col min-h-[500px] lg:max-h-[720px]">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest">Nhật ký hoạt động</h3>
                        <span id="step-counter" class="bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full text-[10px] font-bold">Bước: 0</span>
                    </div>
                    <div id="sim-log" class="flex-grow space-y-3 overflow-y-auto pr-2 custom-scrollbar text-sm">
                        <div class="text-slate-300 italic">Dữ liệu nhật ký sẽ xuất hiện tại đây...</div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        const examples = {
            1: [6, 12, 18, 42, 44, 55, 67, 94],
            2: [5, 11, 18, 39, 41, 52, 63, 70, 85, 88, 91]
        };

        let selectedArrayData = examples[1]; 
        let targetValue = 44;
        let state = {
            left: 0, 
            right: 0,
            mid: -1,
            stepCount: 0,
            subStep: 0, // 0: calculate mid, 1: compare
            finished: false,
            found: false
        };

        function selectArray(id) {
            selectedArrayData = examples[id];
            document.querySelectorAll('.array-select-btn').forEach(btn => {
                btn.classList.remove('border-indigo-500', 'bg-indigo-50', 'ring-4', 'ring-indigo-100');
            });
            const selectedBtn = document.getElementById(`btn-arr-${id}`);
            selectedBtn.classList.add('border-indigo-500', 'bg-indigo-50', 'ring-4', 'ring-indigo-100');
        }

        window.onload = () => { selectArray(1); };

        function startSimulation() {
            const inputVal = document.getElementById('target-input').value;
            if (inputVal === "") return;

            targetValue = parseInt(inputVal);
            state = {
                left: 0,
                right: selectedArrayData.length - 1,
                mid: -1,
                stepCount: 0,
                subStep: 0,
                finished: false,
                found: false
            };

            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('sim-screen').classList.remove('hidden');
            document.getElementById('display-target').innerText = targetValue;
            
            renderArray();
            updateDesc("Bấm nút 'BƯỚC TIẾP' để bắt đầu quá trình tìm kiếm.");
            addLog(`Khởi tạo: Tìm ${targetValue} trong dãy ${selectedArrayData.length} phần tử.`, "system");
        }

        function renderArray() {
            const container = document.getElementById('array-container');
            container.innerHTML = '';
            
            selectedArrayData.forEach((val, idx) => {
                const div = document.createElement('div');
                div.id = `item-${idx}`;
                // Kích thước linh hoạt cho laptop/tablet
                div.className = "array-item relative w-12 h-12 md:w-16 md:h-16 flex items-center justify-center rounded-xl md:rounded-2xl border-2 font-bold text-sm md:text-xl shadow-sm bg-white border-slate-100";
                
                div.innerHTML = `<span class="z-10">${val}</span>`;

                if (state.finished && idx === state.mid && state.found) {
                    div.classList.add('found-item');
                } else if (idx === state.mid) {
                    div.classList.add('mid-item');
                } else if (idx >= state.left && idx <= state.right) {
                    div.classList.add('active-range');
                } else {
                    div.classList.add('inactive-item');
                }

                // Pointer Markers
                if (!state.finished) {
                    if (idx === state.left) createMarker(div, "L", "text-blue-600", "-bottom-6");
                    if (idx === state.right) createMarker(div, "R", "text-blue-600", "-bottom-9");
                    if (idx === state.mid) createMarker(div, "M", "text-amber-600 font-black", "-top-7");
                }

                container.appendChild(div);
            });
        }

        function createMarker(parent, text, color, pos) {
            const span = document.createElement('span');
            span.className = `absolute ${pos} ${color} text-[10px] font-black bg-white px-1 rounded shadow-sm border border-slate-50`;
            span.innerText = text;
            parent.appendChild(span);
        }

        function stepForward() {
            if (state.finished) return;

            const array = selectedArrayData;
            
            if (state.subStep === 0) {
                // Giai đoạn: Tính Mid
                state.stepCount++;
                state.mid = Math.floor((state.left + state.right) / 2);
                
                updateStatus(`Đang xét vị trí giữa: ${state.mid + 1}`, "text-amber-500");
                updateDesc(`<strong>Bước ${state.stepCount}:</strong> Tính vị trí chính giữa của vùng đang xét.<br><span class='text-sm text-slate-500'>Mid = (${state.left + 1} + ${state.right + 1}) / 2 = ${state.mid + 1}</span>`);
                addLog(`Bước ${state.stepCount}.1: Mid = ${state.mid + 1} (Giá trị: ${array[state.mid]})`);
                
                state.subStep = 1;
            } else {
                // Giai đoạn: So sánh
                const midVal = array[state.mid];
                
                if (midVal === targetValue) {
                    state.finished = true;
                    state.found = true;
                    updateStatus("Đã tìm thấy mục tiêu!", "text-emerald-500");
                    updateDesc(`<span class="text-emerald-600">Thành công!</span> Giá trị ${targetValue} nằm ở vị trí ${state.mid + 1}.`);
                    addLog(`KẾT QUẢ: Đã tìm thấy tại vị trí ${state.mid + 1}.`, "success");
                    finishSim();
                } else if (midVal < targetValue) {
                    updateStatus(`${midVal} < ${targetValue} → Tìm bên phải`, "text-indigo-500");
                    updateDesc(`Vì ${midVal} nhỏ hơn ${targetValue}, ta loại bỏ nửa bên trái.`);
                    addLog(`${midVal} < ${targetValue} → Cập nhật Left = ${state.mid + 2}`);
                    state.left = state.mid + 1;
                    state.subStep = 0;
                    state.mid = -1;
                } else {
                    updateStatus(`${midVal} > ${targetValue} → Tìm bên trái`, "text-indigo-500");
                    updateDesc(`Vì ${midVal} lớn hơn ${targetValue}, ta loại bỏ nửa bên phải.`);
                    addLog(`${midVal} > ${targetValue} → Cập nhật Right = ${state.mid}`);
                    state.right = state.mid - 1;
                    state.subStep = 0;
                    state.mid = -1;
                }

                if (state.left > state.right && !state.found) {
                    state.finished = true;
                    updateStatus("Không tìm thấy giá trị", "text-red-500");
                    updateDesc("<span class='text-red-500'>Kết thúc:</span> Giá trị không tồn tại trong dãy này.");
                    addLog(`KẾT THÚC: Không tìm thấy giá trị ${targetValue}.`, "error");
                    finishSim();
                }
            }

            document.getElementById('step-counter').innerText = `Bước: ${state.stepCount}`;
            renderArray();
        }

        function finishSim() {
            const btn = document.getElementById('next-btn');
            btn.innerText = "CHƠI LẠI";
            btn.classList.replace('bg-indigo-600', 'bg-slate-800');
            btn.onclick = () => location.reload();
        }

        function updateStatus(text, colorClass) {
            const el = document.getElementById('status-text');
            el.innerText = text;
            el.className = `text-sm font-bold ${colorClass}`;
        }

        function updateDesc(html) {
            document.getElementById('step-desc').innerHTML = html;
        }

        function addLog(text, type = "normal") {
            const log = document.getElementById('sim-log');
            if (log.innerText.includes("Dữ liệu nhật ký")) log.innerHTML = '';
            
            const div = document.createElement('div');
            let bgClass = "bg-white border-slate-100";
            if (type === "success") bgClass = "bg-emerald-50 border-emerald-100 text-emerald-700 font-bold";
            if (type === "error") bgClass = "bg-red-50 border-red-100 text-red-700 font-bold";
            if (type === "system") bgClass = "bg-indigo-50 border-indigo-100 text-indigo-700";

            div.className = `p-3 rounded-xl border ${bgClass} shadow-sm animate-in slide-in-from-right-4 duration-300`;
            div.innerHTML = text;
            log.prepend(div);
        }
    </script>
</body>
</html>